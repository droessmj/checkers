<!DOCTYPE HTML>
<html>
<head>
	<title>HTML5 Checkers</title>
	<style type="text/css">
		html, body {
		  width:  95%;
		  height: 100%;
		  margin: 0px;
		}

		table {
		   width: 100%;
		   padding-top: 20px;
		   text-align:center;
		}

		td[rowspan] {
			vertical-align: top;
			text-align: left;
		}

		canvas {
        	background-color: black;
        	display: inline;
      	}

      	#turnText {
      		text-align: center;
      		font-size: 25px;
      	}

	</style>
</head>

<body>


<table>
	<tr>
		<td id="redText">
			<font color="red"> Red Player: 12 remaining, 0 king(s)</font>
		</td>
		<td>
			<div id="canvasDiv">
			<canvas id="myCanvas" width="720" height="720"> Your browser does not support Canvas</canvas>
			</div>
		</td>
		<td id="blackText">
			Black Player: 12 remaining, 0 king(s)
		</td>
	</tr>
	<tr >
		<td>&nbsp;</td>
		<td id="turnText">Black's Turn</td>
		<td>&nbsp;</td>
	</tr>
</table>





<script src="jquery.js"></script>
<script src="checker.js"></script>
<script src="playablesquare.js"></script>
<script>

var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");


function getCheckerBySquareNum(num){
	var checker = "";
	for(var i = 0; i<blackCheckers.length; i++){
		if(blackCheckers[i].currentSquare == num){
			checker = blackCheckers[i];
		}else if(redCheckers[i].currentSquare == num){
			checker = redCheckers[i];
		}
	}
	return checker;
}

function checkGameStatus(){
	if(redRemaining == 0){
		//display black wins
		alert("Black player wins!");
	}
	else if(blackRemaining == 0){
		//display red wins
		alert("Red player wins!");

	}else{
		
	}
}


//function to change text denoting who's turn it is
function changeTurnText(s){
	if(s == "Red"){
		$("#turnText").css('color', 'red');
	}else{
		$("#turnText").css('color', 'black');
	}
	$("#turnText").html(s + "\'s turn");

	//update number of pieces and kings remaining for each player
	$("#redText").css('color', 'red');
	$("#redText").html("Red Player: " + redRemaining + " remaining, " + redKings + " king(s)");
	$("#blackText").html("Black Player: " + blackRemaining + " remaining, " + blackKings + " king(s)");
}

function handleScreenSize(mouseX, mouseY){
	//this function needs to make adjustments to click input to adjust for resizing of the window
	//while game pieces stay in consistent places
	var outputArray = [];

	var position = $("#myCanvas").offset();
	mouseX = mouseX - position.left;
	mouseY = mouseY - position.top;

	outputArray[0] = mouseX;
	outputArray[1] = mouseY;

	return outputArray;
}

//create a 2d array to store all the places on the board
var board = new Array(8);
for(var k = 0; k<board.length; k++){
	board[k] = new Array(8);
}

//track all the red checkers
var redCheckers = [];
//and all the black checkers
var blackCheckers = [];
//all the playable squares
var playableSquares = [];


//tracking remaining pieces and kings for each color
var blackKings = 0;
var redKings = 0;
var blackRemaining = 12;
var redRemaining = 12;
//- == Unplayable
//E == Empty
//X == red player
//O == black player

//draw the board and place the original checkers
var squareNumber = 0;
for(var i=0; i<8; i++){
	for (var j=0; j<8; j++){
		if((j % 2) == 0 && ((i % 2) == 0)){
			ctx.fillStyle = "red";
			ctx.fillRect((90*j), (90*i),90,90);
			board[i][j] = "-";
		}else if((j % 2) == 1 && ((i % 2) == 1)){
			ctx.fillStyle = "red";
			ctx.fillRect((90*j), (90*i),90,90);
			board[i][j] = "-";
		}else{
			if(i<3){
				//create and place the original checkers--12 checkers, black squares
				//red checkers
				board[i][j] = "X";

				var checker = new Checker(90*j+45, 90*i+45, "red");
				checker.draw();

				var square = new PlayableSquare(90*j, 90*i,90,90,squareNumber);
				checker.setCurrentSquare(squareNumber);
				squareNumber++;
				square.placeChecker(checker);

				//push to the arrays
				redCheckers.push(checker)
				playableSquares.push(square);

			}else if(i>4){
				//black checkers
				board[i][j] = "O";
				var checker = new Checker(90*j+45, 90*i+45,"black");
				checker.draw();
      			

      			var square = new PlayableSquare(90*j, 90*i,90,90,squareNumber);
      			checker.setCurrentSquare(squareNumber);
      			squareNumber++;
				square.placeChecker(checker);

				blackCheckers.push(checker);
				playableSquares.push(square);

			}else{
				board[i][j] = "E";
				//add the black square to the array squares that are playable
				playableSquares.push(new PlayableSquare(90*j, 90*i,90,90,squareNumber));
				squareNumber++;
			}
			
		}
	}
}



//tracks whether a checker is currently selected or not
var selected = false;
var checkerSelected = "";
var previousSquare = "";
var turn = "black";

//create listener for playing the game
$("#myCanvas").click(function(event){

	var mouseX = event.clientX;
	var mouseY = event.clientY;
	var adjustedMouseOutput = handleScreenSize(mouseX, mouseY);
	mouseX = adjustedMouseOutput[0];
	mouseY = adjustedMouseOutput[1];

	//check if a checker is being selected
	if(selected == false){
		for(var i =0; i<redCheckers.length; i++){
			redChecker = redCheckers[i];
			blackChecker = blackCheckers[i];

			if(turn == "red" && (mouseX > redChecker.getX()-45 && mouseX < redChecker.getX() + 45) && (mouseY > redChecker.getY()-45 && mouseY < redChecker.getY() + 45)){
				//highlight the circle
				redChecker.select();
				selected = true;
				checkerSelected = redChecker;
				previousSquare = checkerSelected.findSquare();

			}else if(turn == "black" && (mouseX > blackChecker.getX()-45) && (mouseX < (blackChecker.getX() + 45)) && (mouseY > blackChecker.getY()-45) && (mouseY < blackChecker.getY() + 45)){
				//highlight the circle
				blackChecker.select();
				selected = true;
				checkerSelected = blackChecker;
				previousSquare = checkerSelected.findSquare();
			}
		}
	//unselect or move an already selected checker	
	}else if(selected == true){
		//console.log(previousSquare.getX() + " " + previousSquare.getY());
		
		//if the checker is to be moved
		for(var h = 0; h < playableSquares.length; h++){
			var gameSquare = playableSquares[h];
			if(gameSquare.isClicked(mouseX, mouseY) && gameSquare.isEmpty()){
				//move the checker if the move is valid
				if(checkerSelected.move(playableSquares, gameSquare)){
					//need to remove checker from previous position
					if(previousSquare != ""){
						previousSquare.removeChecker();
					}
					checkerSelected.draw();
					gameSquare.placeChecker(checkerSelected);
					previousSquare = "";

					//check for double jump
					if(checkerSelected.checkDouble()){
						//do nothing?
					}else{
						//no double jump opportunity
						if(turn == "black"){
							turn = "red";
							changeTurnText("Red");
						}else{
							turn = "black";
							changeTurnText("Black");
						}

					}
				}
			}
		}

		//if the checker is clicked again to be unselected
		for(var i =0; i<redCheckers.length; i++){
			redChecker = redCheckers[i];
			blackChecker = blackCheckers[i];

			if((mouseX > redChecker.getX()-45 && mouseX < redChecker.getX() + 45) && (mouseY > redChecker.getY()-45 && mouseY < redChecker.getY() + 45)){
				//highlight the circle
				if(redChecker.isSelected()){
					redChecker.unselect();
					selected = false;
				}				
			}else if((mouseX > blackChecker.getX()-45) && (mouseX < (blackChecker.getX() + 45)) && (mouseY > blackChecker.getY()-45) && (mouseY < blackChecker.getY() + 45)){
				//highlight the circle
				if(blackChecker.isSelected()){
					blackChecker.unselect();
					selected = false;
				}
			}
		}	
	}
	checkGameStatus();
});


</script>

<p> TODO: Implement double jump. Perfect king movement and jumping </p>

</body>
</html>
